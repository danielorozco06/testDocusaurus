"use strict";(self.webpackChunkjest_website=self.webpackChunkjest_website||[]).push([[1034],{6551:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>u});var t=s(4848),o=s(8453),a=s(1470),r=s(9365);const l={id:"webpack",title:"Using with webpack"},i=void 0,c={id:"webpack",title:"Using with webpack",description:"Jest can be used in projects that use webpack to manage assets, styles, and compilation. webpack does offer some unique challenges over other tools because it integrates directly with your application to allow managing stylesheets, assets like images and fonts, along with the expansive ecosystem of compile-to-JavaScript languages and tools.",source:"@site/../docs/Webpack.md",sourceDirName:".",slug:"/webpack",permalink:"/docs/next/webpack",draft:!1,unlisted:!1,editUrl:"https://github.com/jestjs/jest/edit/main/website/../docs/Webpack.md",tags:[],version:"current",lastUpdatedBy:"daorozc",lastUpdatedAt:1709673938,formattedLastUpdatedAt:"Mar 5, 2024",frontMatter:{id:"webpack",title:"Using with webpack"},sidebar:"docs",previous:{title:"ECMAScript Modules",permalink:"/docs/next/ecmascript-modules"},next:{title:"Using with puppeteer",permalink:"/docs/next/puppeteer"}},d={},u=[{value:"A webpack example",id:"a-webpack-example",level:2},{value:"Handling Static Assets",id:"handling-static-assets",level:3},{value:"Mocking CSS Modules",id:"mocking-css-modules",level:3},{value:"Configuring Jest to find our files",id:"configuring-jest-to-find-our-files",level:3},{value:"Using with webpack",id:"using-with-webpack",level:2}];function p(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["Jest can be used in projects that use ",(0,t.jsx)(n.a,{href:"https://webpack.js.org/",children:"webpack"})," to manage assets, styles, and compilation. webpack ",(0,t.jsx)(n.em,{children:"does"})," offer some unique challenges over other tools because it integrates directly with your application to allow managing stylesheets, assets like images and fonts, along with the expansive ecosystem of compile-to-JavaScript languages and tools."]}),"\n",(0,t.jsx)(n.h2,{id:"a-webpack-example",children:"A webpack example"}),"\n",(0,t.jsx)(n.p,{children:"Let's start with a common sort of webpack config file and translate it to a Jest setup."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="webpack.config.js"',children:"module.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.jsx?$/,\n        exclude: ['node_modules'],\n        use: ['babel-loader'],\n      },\n      {\n        test: /\\.css$/,\n        use: ['style-loader', 'css-loader'],\n      },\n      {\n        test: /\\.gif$/,\n        type: 'asset/inline',\n      },\n      {\n        test: /\\.(ttf|eot|svg)$/,\n        type: 'asset/resource',\n      },\n    ],\n  },\n  resolve: {\n    alias: {\n      config$: './configs/app-config.js',\n      react: './vendor/react-master',\n    },\n    extensions: ['.js', '.jsx'],\n    modules: [\n      'node_modules',\n      'bower_components',\n      'shared',\n      '/shared/vendor/modules',\n    ],\n  },\n};\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If you have JavaScript files that are transformed by Babel, you can ",(0,t.jsx)(n.a,{href:"/docs/next/getting-started#using-babel",children:"enable support for Babel"})," by installing the ",(0,t.jsx)(n.code,{children:"babel-jest"})," plugin. Non-Babel JavaScript transformations can be handled with Jest's ",(0,t.jsx)(n.a,{href:"/docs/next/configuration#transform-objectstring-pathtotransformer--pathtotransformer-object",children:(0,t.jsx)(n.code,{children:"transform"})})," config option."]}),"\n",(0,t.jsx)(n.h3,{id:"handling-static-assets",children:"Handling Static Assets"}),"\n",(0,t.jsx)(n.p,{children:"Next, let's configure Jest to gracefully handle asset files such as stylesheets and images. Usually, these files aren't particularly useful in tests so we can safely mock them out. However, if you are using CSS Modules then it's better to mock a proxy for your className lookups."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="jest.config.js"',children:"module.exports = {\n  moduleNameMapper: {\n    '\\\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$':\n      '<rootDir>/__mocks__/fileMock.js',\n    '\\\\.(css|less)$': '<rootDir>/__mocks__/styleMock.js',\n  },\n};\n"})}),"\n",(0,t.jsx)(n.p,{children:"And the mock files themselves:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="__mocks__/styleMock.js"',children:"module.exports = {};\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="__mocks__/fileMock.js"',children:"module.exports = 'test-file-stub';\n"})}),"\n",(0,t.jsx)(n.h3,{id:"mocking-css-modules",children:"Mocking CSS Modules"}),"\n",(0,t.jsxs)(n.p,{children:["You can use an ",(0,t.jsx)(n.a,{href:"https://github.com/keyanzhang/identity-obj-proxy",children:"ES6 Proxy"})," to mock ",(0,t.jsx)(n.a,{href:"https://github.com/css-modules/css-modules",children:"CSS Modules"}),":"]}),"\n",(0,t.jsxs)(a.A,{groupId:"npm2yarn",children:[(0,t.jsx)(r.A,{value:"npm",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install --save-dev identity-obj-proxy\n"})})}),(0,t.jsx)(r.A,{value:"yarn",label:"Yarn",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"yarn add --dev identity-obj-proxy\n"})})}),(0,t.jsx)(r.A,{value:"pnpm",label:"pnpm",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm add --save-dev identity-obj-proxy\n"})})})]}),"\n",(0,t.jsxs)(n.p,{children:["Then all your className lookups on the styles object will be returned as-is (e.g., ",(0,t.jsx)(n.code,{children:"styles.foobar === 'foobar'"}),"). This is pretty handy for React ",(0,t.jsx)(n.a,{href:"/docs/next/snapshot-testing",children:"Snapshot Testing"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="jest.config.js (for CSS Modules)"',children:"module.exports = {\n  moduleNameMapper: {\n    '\\\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$':\n      '<rootDir>/__mocks__/fileMock.js',\n    '\\\\.(css|less)$': 'identity-obj-proxy',\n  },\n};\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If ",(0,t.jsx)(n.code,{children:"moduleNameMapper"})," cannot fulfill your requirements, you can use Jest's ",(0,t.jsx)(n.a,{href:"/docs/next/configuration#transform-objectstring-pathtotransformer--pathtotransformer-object",children:(0,t.jsx)(n.code,{children:"transform"})})," config option to specify how assets are transformed. For example, a transformer that returns the basename of a file (such that ",(0,t.jsx)(n.code,{children:"require('logo.jpg');"})," returns ",(0,t.jsx)(n.code,{children:"'logo'"}),") can be written as:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="fileTransformer.js"',children:"const path = require('path');\n\nmodule.exports = {\n  process(sourceText, sourcePath, options) {\n    return {\n      code: `module.exports = ${JSON.stringify(path.basename(sourcePath))};`,\n    };\n  },\n};\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="jest.config.js (for custom transformers and CSS Modules)"',children:"module.exports = {\n  moduleNameMapper: {\n    '\\\\.(css|less)$': 'identity-obj-proxy',\n  },\n  transform: {\n    '\\\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$':\n      '<rootDir>/fileTransformer.js',\n  },\n};\n"})}),"\n",(0,t.jsx)(n.p,{children:"We've told Jest to ignore files matching a stylesheet or image extension, and instead, require our mock files. You can adjust the regular expression to match the file types your webpack config handles."}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsxs)(n.p,{children:["Remember to include the default ",(0,t.jsx)(n.code,{children:"babel-jest"})," transformer explicitly, if you wish to use it alongside with additional code preprocessors:"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"transform": {\n  "\\\\.[jt]sx?$": "babel-jest",\n  "\\\\.css$": "some-css-transformer",\n}\n'})})]}),"\n",(0,t.jsx)(n.h3,{id:"configuring-jest-to-find-our-files",children:"Configuring Jest to find our files"}),"\n",(0,t.jsxs)(n.p,{children:["Now that Jest knows how to process our files, we need to tell it how to ",(0,t.jsx)(n.em,{children:"find"})," them. For webpack's ",(0,t.jsx)(n.code,{children:"modules"}),", and ",(0,t.jsx)(n.code,{children:"extensions"})," options there are direct analogs in Jest's ",(0,t.jsx)(n.code,{children:"moduleDirectories"})," and ",(0,t.jsx)(n.code,{children:"moduleFileExtensions"})," options."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="jest.config.js"',children:"module.exports = {\n  moduleFileExtensions: ['js', 'jsx'],\n  moduleDirectories: ['node_modules', 'bower_components', 'shared'],\n\n  moduleNameMapper: {\n    '\\\\.(css|less)$': '<rootDir>/__mocks__/styleMock.js',\n    '\\\\.(gif|ttf|eot|svg)$': '<rootDir>/__mocks__/fileMock.js',\n  },\n};\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"<rootDir>"})," is a special token that gets replaced by Jest with the root of your project. Most of the time this will be the folder where your ",(0,t.jsx)(n.code,{children:"package.json"})," is located unless you specify a custom ",(0,t.jsx)(n.a,{href:"/docs/next/configuration#rootdir-string",children:(0,t.jsx)(n.code,{children:"rootDir"})})," option in your configuration."]})}),"\n",(0,t.jsxs)(n.p,{children:["Similarly, Jest's counterpart for Webpack's ",(0,t.jsx)(n.code,{children:"resolve.roots"})," (an alternative to setting ",(0,t.jsx)(n.code,{children:"NODE_PATH"}),") is ",(0,t.jsx)(n.code,{children:"modulePaths"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="jest.config.js"',children:"module.exports = {\n  modulePaths: ['/shared/vendor/modules'],\n  moduleFileExtensions: ['js', 'jsx'],\n  moduleDirectories: ['node_modules', 'bower_components', 'shared'],\n  moduleNameMapper: {\n    '\\\\.(css|less)$': '<rootDir>/__mocks__/styleMock.js',\n    '\\\\.(gif|ttf|eot|svg)$': '<rootDir>/__mocks__/fileMock.js',\n  },\n};\n"})}),"\n",(0,t.jsxs)(n.p,{children:["And finally, we have to handle the webpack ",(0,t.jsx)(n.code,{children:"alias"}),". For that, we can make use of the ",(0,t.jsx)(n.code,{children:"moduleNameMapper"})," option again."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="jest.config.js"',children:"module.exports = {\n  modulePaths: ['/shared/vendor/modules'],\n  moduleFileExtensions: ['js', 'jsx'],\n  moduleDirectories: ['node_modules', 'bower_components', 'shared'],\n\n  moduleNameMapper: {\n    '\\\\.(css|less)$': '<rootDir>/__mocks__/styleMock.js',\n    '\\\\.(gif|ttf|eot|svg)$': '<rootDir>/__mocks__/fileMock.js',\n\n    '^react(.*)$': '<rootDir>/vendor/react-master$1',\n    '^config$': '<rootDir>/configs/app-config.js',\n  },\n};\n"})}),"\n",(0,t.jsx)(n.p,{children:"That's it! webpack is a complex and flexible tool, so you may have to make some adjustments to handle your specific application's needs. Luckily for most projects, Jest should be more than flexible enough to handle your webpack config."}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["For more complex webpack configurations, you may also want to investigate projects such as: ",(0,t.jsx)(n.a,{href:"https://github.com/istarkov/babel-plugin-webpack-loaders",children:"babel-plugin-webpack-loaders"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"using-with-webpack",children:"Using with webpack"}),"\n",(0,t.jsxs)(n.p,{children:["In addition to installing ",(0,t.jsx)(n.code,{children:"babel-jest"})," as described earlier, you'll need to add ",(0,t.jsx)(n.code,{children:"@babel/preset-env"})," like so:"]}),"\n",(0,t.jsxs)(a.A,{groupId:"npm2yarn",children:[(0,t.jsx)(r.A,{value:"npm",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install --save-dev @babel/preset-env\n"})})}),(0,t.jsx)(r.A,{value:"yarn",label:"Yarn",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"yarn add --dev @babel/preset-env\n"})})}),(0,t.jsx)(r.A,{value:"pnpm",label:"pnpm",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm add --save-dev @babel/preset-env\n"})})})]}),"\n",(0,t.jsx)(n.p,{children:"Then, you'll want to configure Babel as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title=".babelrc"',children:'{\n  "presets": ["@babel/preset-env"]\n}\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Jest caches files to speed up test execution. If you updated ",(0,t.jsx)(n.code,{children:".babelrc"})," and Jest is not working as expected, try clearing the cache by running ",(0,t.jsx)(n.code,{children:"jest --clearCache"}),"."]})}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsxs)(n.p,{children:["If you use dynamic imports (",(0,t.jsx)(n.code,{children:"import('some-file.js').then(module => ...)"}),"), you need to enable the ",(0,t.jsx)(n.code,{children:"dynamic-import-node"})," plugin."]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title=".babelrc"',children:'{\n  "presets": [["env", {"modules": false}]],\n\n  "plugins": ["syntax-dynamic-import"],\n\n  "env": {\n    "test": {\n      "plugins": ["dynamic-import-node"]\n    }\n  }\n}\n'})})]}),"\n",(0,t.jsxs)(n.p,{children:["For an example of how to use Jest with webpack with React, you can view one ",(0,t.jsx)(n.a,{href:"https://github.com/jenniferabowd/jest_webpack_example",children:"here"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},9365:(e,n,s)=>{s.d(n,{A:()=>r});s(6540);var t=s(4164);const o={tabItem:"tabItem_Ymn6"};var a=s(4848);function r(e){let{children:n,hidden:s,className:r}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,t.A)(o.tabItem,r),hidden:s,children:n})}},1470:(e,n,s)=>{s.d(n,{A:()=>v});var t=s(6540),o=s(4164),a=s(3104),r=s(6347),l=s(205),i=s(7485),c=s(1682),d=s(9466);function u(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:s}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:s,attributes:t,default:o}}=e;return{value:n,label:s,attributes:t,default:o}}))}(s);return function(e){const n=(0,c.X)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,s])}function h(e){let{value:n,tabValues:s}=e;return s.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:s}=e;const o=(0,r.W6)(),a=function(e){let{queryString:n=!1,groupId:s}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!s)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return s??null}({queryString:n,groupId:s});return[(0,i.aZ)(a),(0,t.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(o.location.search);n.set(a,e),o.replace({...o.location,search:n.toString()})}),[a,o])]}function f(e){const{defaultValue:n,queryString:s=!1,groupId:o}=e,a=p(e),[r,i]=(0,t.useState)((()=>function(e){let{defaultValue:n,tabValues:s}=e;if(0===s.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:s}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${s.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=s.find((e=>e.default))??s[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:a}))),[c,u]=m({queryString:s,groupId:o}),[f,g]=function(e){let{groupId:n}=e;const s=function(e){return e?`docusaurus.tab.${e}`:null}(n),[o,a]=(0,d.Dv)(s);return[o,(0,t.useCallback)((e=>{s&&a.set(e)}),[s,a])]}({groupId:o}),j=(()=>{const e=c??f;return h({value:e,tabValues:a})?e:null})();(0,l.A)((()=>{j&&i(j)}),[j]);return{selectedValue:r,selectValue:(0,t.useCallback)((e=>{if(!h({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);i(e),u(e),g(e)}),[u,g,a]),tabValues:a}}var g=s(2303);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=s(4848);function x(e){let{className:n,block:s,selectedValue:t,selectValue:r,tabValues:l}=e;const i=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.a_)(),d=e=>{const n=e.currentTarget,s=i.indexOf(n),o=l[s].value;o!==t&&(c(n),r(o))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const s=i.indexOf(e.currentTarget)+1;n=i[s]??i[0];break}case"ArrowLeft":{const s=i.indexOf(e.currentTarget)-1;n=i[s]??i[i.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":s},n),children:l.map((e=>{let{value:n,label:s,attributes:a}=e;return(0,b.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>i.push(e),onKeyDown:u,onClick:d,...a,className:(0,o.A)("tabs__item",j.tabItem,a?.className,{"tabs__item--active":t===n}),children:s??n},n)}))})}function y(e){let{lazy:n,children:s,selectedValue:o}=e;const a=(Array.isArray(s)?s:[s]).filter(Boolean);if(n){const e=a.find((e=>e.props.value===o));return e?(0,t.cloneElement)(e,{className:"margin-top--md"}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==o})))})}function w(e){const n=f(e);return(0,b.jsxs)("div",{className:(0,o.A)("tabs-container",j.tabList),children:[(0,b.jsx)(x,{...e,...n}),(0,b.jsx)(y,{...e,...n})]})}function v(e){const n=(0,g.A)();return(0,b.jsx)(w,{...e,children:u(e.children)},String(n))}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>l});var t=s(6540);const o={},a=t.createContext(o);function r(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);